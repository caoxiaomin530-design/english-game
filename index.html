<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éœæ ¼æ²ƒèŒ¨å•è¯è¯•ç‚¼</title>
    <style>
        :root { --gold: #ffd700; --magic: #00ffcc; }
        body {
            background: radial-gradient(circle at center, #1b2735 0%, #090a0f 100%);
            color: #fff; font-family: "PingFang SC", sans-serif;
            margin: 0; overflow: hidden; touch-action: manipulation;
        }

        /* æ¸¸æˆèˆå° */
        #game-stage {
            width: 100vw; height: 100vh; position: relative;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        /* é¡¶éƒ¨ä¿¡æ¯æ  */
        #hud {
            position: absolute; top: 0; width: 100%; padding: 15px;
            background: rgba(0,0,0,0.7); display: none; justify-content: space-between;
            color: var(--gold); z-index: 10; box-sizing: border-box;
        }

        /* èœå•ç•Œé¢ */
        #menu-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: flex; flex-direction: column; align-items: center; padding-top: 50px;
        }

        .unit-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 90%; max-width: 500px; }
        .unit-btn { 
            padding: 15px; background: #3b1e54; color: var(--gold); 
            border: 2px solid var(--gold); cursor: pointer; border-radius: 12px; font-weight: bold;
        }

        /* æ ¸å¿ƒå†…å®¹åŒº */
        #content-area { width: 90%; max-width: 600px; z-index: 5; text-align: center; }
        .big-word { font-size: 50px; color: var(--gold); margin: 20px 0; text-shadow: 0 0 10px #000; }
        .hint-text { font-size: 24px; color: #ccc; margin-bottom: 20px; }
        
        /* äº¤äº’æŒ‰é’® */
        .btn {
            width: 85%; padding: 15px; margin: 10px 0;
            background: rgba(255,255,255,0.1); border: 2px solid #fff;
            color: #fff; font-size: 18px; border-radius: 50px; cursor: pointer;
        }
        .correct { background: #27ae60 !important; }
        .wrong { background: #c0392b !important; animation: shake 0.3s; }

        /* é­”æ³•å°„å‡»åŒº */
        #combat-zone { display: none; width: 100%; height: 100%; position: absolute; top: 0; z-index: 5; }
        #harry { font-size: 50px; position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%); }
        .enemy { 
            position: absolute; background: white; color: black; padding: 10px 20px; 
            border-radius: 8px; font-weight: bold; font-size: 20px; box-shadow: 0 0 20px var(--gold);
        }
        .spell { 
            width: 10px; height: 10px; background: #00ff00; border-radius: 50%; 
            position: absolute; box-shadow: 0 0 15px #00ff00; 
        }

        #input-box { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: center; }
        #spell-input { 
            width: 80%; padding: 12px; font-size: 20px; border: 2px solid var(--gold); 
            background: #000; color: #fff; border-radius: 20px; text-align: center;
        }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    </style>
</head>
<body>

    <div id="game-stage">
        <div id="menu-screen">
            <h1 style="margin-bottom: 5px;">éœæ ¼æ²ƒèŒ¨å•è¯è¯¾</h1>
            <p style="color:#888; margin-bottom: 30px;">æ²ªæ•™ç‰ˆå››ä¸‹ Â· é­”æ³•ç‰¹è®­</p>
            <div id="unit-list" class="unit-grid"></div>
        </div>

        <div id="hud">
            <div onclick="location.reload()">é€€å‡º</div>
            <div id="stage-info">æ­£åœ¨åŠ è½½</div>
            <div>å¾—åˆ†: <span id="score">0</span></div>
        </div>

        <div id="content-area" style="display:none;">
            <div id="display-text"></div>
            <div id="options-container"></div>
            <div id="status-hint" style="margin-top:20px; color:#aaa; font-size:14px;"></div>
        </div>

        <div id="combat-zone">
            <div id="harry">ğŸ§™â€â™‚ï¸</div>
            <div id="input-box">
                <input type="text" id="spell-input" placeholder="è¾“å…¥å•è¯æ‹¼å†™..." autocomplete="off">
            </div>
        </div>
    </div>

<script>
    // è¯åº“é…ç½®
    const DATA = {
        "Unit 1": [{en:"get up",cn:"èµ·åºŠ"},{en:"have breakfast",cn:"åƒæ—©é¤"},{en:"go to school",cn:"ä¸Šå­¦"},{en:"have lunch",cn:"åƒåˆé¤"},{en:"go home",cn:"å›å®¶"}],
        "Unit 2": [{en:"Chinese",cn:"è¯­æ–‡"},{en:"Maths",cn:"æ•°å­¦"},{en:"English",cn:"è‹±è¯­"},{en:"PE",cn:"ä½“è‚²"},{en:"Music",cn:"éŸ³ä¹"}]
    };

    let state = {
        groupWords: [],
        currentIndex: 0,
        step: 1, // 1:è·Ÿè¯»3é, 2:å¬éŸ³è¯†ä¹‰, 3:çœ‹ä¸­è¯´è‹±, 4:æ‹¼å†™å°„å‡»
        repeatLeft: 3,
        score: 0
    };

    const synth = window.speechSynthesis;
    const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

    function init() {
        const list = document.getElementById('unit-list');
        for(let u in DATA) {
            let b = document.createElement('div');
            b.className = 'unit-btn';
            b.innerText = u;
            b.onclick = () => startUnit(u);
            list.appendChild(b);
        }
    }

    function startUnit(u) {
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('hud').style.display = 'flex';
        document.getElementById('content-area').style.display = 'block';
        state.groupWords = DATA[u].slice(0, 5); // æš‚å–å‰5ä¸ªä½œä¸ºç¬¬ä¸€ç»„
        state.step = 1;
        state.currentIndex = 0;
        runStep();
    }

    function runStep() {
        const word = state.groupWords[state.currentIndex];
        const display = document.getElementById('display-text');
        const container = document.getElementById('options-container');
        const hint = document.getElementById('status-hint');
        
        container.innerHTML = '';
        document.getElementById('combat-zone').style.display = 'none';
        document.getElementById('content-area').style.display = 'block';

        if (state.step === 1) { // æ­¥éª¤1ï¼šè·Ÿè¯»3é
            document.getElementById('stage-info').innerText = "Step 1: é­”æ³•è·Ÿè¯»";
            display.innerHTML = `<div class="big-word">${word.en}</div><div class="hint-text">${word.cn}</div>`;
            hint.innerText = `ç‚¹å‡»æŒ‰é’®ï¼Œå¬é­”æ³•ç¤ºèŒƒï¼ˆå‰©ä½™ ${state.repeatLeft} æ¬¡ï¼‰`;
            
            let b = document.createElement('div');
            b.className = 'btn';
            b.innerText = "è†å¬å’’è¯­";
            b.onclick = () => {
                speak(word.en);
                state.repeatLeft--;
                if(state.repeatLeft <= 0) {
                    state.repeatLeft = 3;
                    nextWord();
                } else {
                    hint.innerText = `ç‚¹å‡»æŒ‰é’®ï¼Œå¬é­”æ³•ç¤ºèŒƒï¼ˆå‰©ä½™ ${state.repeatLeft} æ¬¡ï¼‰`;
                }
            };
            container.appendChild(b);

        } else if (state.step === 2) { // æ­¥éª¤2ï¼šå¬éŸ³è¾¨ä¹‰
            document.getElementById('stage-info').innerText = "Step 2: å¬éŸ³è¾¨ä¹‰";
            display.innerHTML = `<div class="big-word" onclick="speak('${word.en}')">ğŸ”Š</div>`;
            hint.innerText = "ç‚¹å‡»å–‡å­ï¼Œé€‰å‡ºæ­£ç¡®çš„ä¸­æ–‡å«ä¹‰";
            speak(word.en);
            
            let options = [...state.groupWords].sort(() => Math.random() - 0.5);
            options.forEach(o => {
                let b = document.createElement('div');
                b.className = 'btn';
                b.innerText = o.cn;
                b.onclick = () => {
                    if(o.en === word.en) {
                        b.classList.add('correct');
                        setTimeout(nextWord, 500);
                    } else {
                        b.classList.add('wrong');
                    }
                };
                container.appendChild(b);
            });

        } else if (state.step === 3) { // æ­¥éª¤3ï¼šä¸­è¯‘è‹±
            document.getElementById('stage-info').innerText = "Step 3: å’’è¯­æ˜¾ç°";
            display.innerHTML = `<div class="big-word">${word.cn}</div>`;
            hint.innerText = "è¿™ä¸ªè¯å¯¹åº”çš„è‹±è¯­å’’è¯­æ˜¯ï¼Ÿ";
            
            let options = [...state.groupWords].sort(() => Math.random() - 0.5);
            options.forEach(o => {
                let b = document.createElement('div');
                b.className = 'btn';
                b.innerText = o.en;
                b.onclick = () => {
                    if(o.en === word.en) {
                        b.classList.add('correct');
                        speak(word.en);
                        setTimeout(nextWord, 500);
                    } else {
                        b.classList.add('wrong');
                    }
                };
                container.appendChild(b);
            });

        } else if (state.step === 4) { // æ­¥éª¤4ï¼šæ‹¼å†™å°„å‡»
            document.getElementById('content-area').style.display = 'none';
            document.getElementById('combat-zone').style.display = 'block';
            document.getElementById('stage-info').innerText = "Step 4: ç»ˆæå†³æ–—";
            
            const oldEnemy = document.querySelector('.enemy');
            if(oldEnemy) oldEnemy.remove();

            let enemy = document.createElement('div');
            enemy.className = 'enemy';
            enemy.innerText = word.cn;
            enemy.style.top = "100px";
            enemy.style.left = "50%";
            enemy.style.transform = "translateX(-50%)";
            document.getElementById('combat-zone').appendChild(enemy);

            const input = document.getElementById('spell-input');
            input.value = '';
            input.focus();
            input.onkeypress = (e) => {
                if(e.key === 'Enter') {
                    if(input.value.trim().toLowerCase() === word.en.toLowerCase()) {
                        fireMagic(enemy);
                    } else {
                        input.classList.add('misfire');
                        setTimeout(() => input.classList.remove('misfire'), 500);
                    }
                }
            };
        }
    }

    function fireMagic(enemy) {
        let b = document.createElement('div');
        b.className = 'spell';
        b.style.bottom = "150px";
        b.style.left = "50%";
        document.getElementById('combat-zone').appendChild(b);

        // ç®€å•çš„é£è¡ŒåŠ¨ç”»
        setTimeout(() => {
            b.style.transition = "all 0.3s ease-in";
            b.style.top = "100px";
            setTimeout(() => {
                b.remove();
                enemy.remove();
                state.score += 10;
                document.getElementById('score').innerText = state.score;
                nextWord();
            }, 300);
        }, 10);
    }

    function nextWord() {
        state.currentIndex++;
        if(state.currentIndex >= state.groupWords.length) {
            state.currentIndex = 0;
            state.step++;
            if(state.step > 4) {
                alert("æœ¬ç»„5ä¸ªå•è¯å·²ç»ƒå®Œï¼å‡†å¤‡è¿›å…¥ä¸‹ä¸€å•å…ƒæˆ–å¤ä¹ ã€‚");
                location.reload();
                return;
            }
        }
        runStep();
    }

    function speak(t) {
        if(synth.speaking) synth.cancel();
        let u = new SpeechSynthesisUtterance(t);
        u.lang = 'en-US';
        synth.speak(u);
    }

    init();
</script>
</body>
</html>
