<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ëã±ËØ≠ÂçïËØçÈ≠îÊ≥ïÈóØÂÖ≥</title>
    <style>
        body {
            background: radial-gradient(circle at bottom, #1b2735 0%, #090a0f 100%);
            color: #fff;
            font-family: sans-serif;
            text-align: center;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation;
        }
        /* ÊòüÁ©∫ËÉåÊôØ */
        .stars { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; }
        .stars::after { content: "."; position: absolute; top: 10%; left: 20%; font-size: 20px; color: yellow; opacity: 0.5; box-shadow: 100px 200px 0 white, 200px 50px 0 yellow, -50px 300px 0 white; animation: twinkle 5s infinite; }
        @keyframes twinkle { 50% { opacity: 0.2; transform: scale(0.8); } }
        
        #game-stage { position: relative; width: 100vw; height: 100vh; z-index: 10; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        /* ËèúÂçï */
        #menu-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(9, 10, 15, 0.95); z-index: 100; display: flex; flex-direction: column; align-items: center; padding-top: 40px; overflow-y: auto; }
        h1 { color: #ffd700; font-size: 28px; text-shadow: 0 0 10px #ff9900; margin-bottom: 5px; }
        .subtitle { color: #888; font-size: 14px; margin-bottom: 20px; }
        
        #unit-list { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 90%; max-width: 500px; padding-bottom: 50px; }
        .unit-btn { padding: 15px; font-size: 16px; background: #2c3e50; color: #ffd700; border: 2px solid #f39c12; cursor: pointer; border-radius: 12px; font-weight: bold; transition: transform 0.1s; }
        .unit-btn:active { transform: scale(0.95); background: #34495e; }
        
        /* Â≠¶‰π†Âå∫ */
        #center-display { width: 90%; max-width: 600px; display: flex; flex-direction: column; align-items: center; }
        .big-word { font-size: 40px; color: #f1c40f; font-weight: bold; margin: 15px 0; line-height: 1.2; }
        .hint-text { font-size: 22px; color: #ecf0f1; margin-bottom: 25px; }
        
        .option-btn { width: 100%; padding: 16px; margin: 8px 0; background: rgba(255, 255, 255, 0.1); border: 2px solid #bdc3c7; color: white; font-size: 18px; cursor: pointer; border-radius: 50px; }
        .correct { background: #27ae60 !important; border-color: #2ecc71 !important; }
        .wrong { background: #c0392b !important; border-color: #e74c3c !important; }
        
        #hud { position: absolute; top: 0; width: 100%; padding: 10px 20px; background: rgba(0,0,0,0.6); display: flex; justify-content: space-between; color: #ffd700; font-size: 15px; box-sizing: border-box; }
        
        #combat-layer { display: none; width: 100%; height: 100%; position: absolute; top:0; left:0; z-index: 50; }
        #player { font-size: 40px; position: absolute; bottom: 90px; left: 50%; transform: translateX(-50%); }
        .enemy { position: absolute; color: #e74c3c; font-weight: bold; font-size: 22px; background: rgba(255,255,255,0.9); padding: 6px 12px; border-radius: 6px; }
        .bullet { width: 10px; height: 10px; background: #2ecc71; border-radius: 50%; position: absolute; }
        
        #input-area { position: absolute; bottom: 30px; width: 100%; display: flex; justify-content: center; }
        #answer-input { width: 75%; padding: 12px; font-size: 20px; text-align: center; border-radius: 25px; border: 3px solid #f1c40f; background: rgba(0,0,0,0.85); color: white; outline: none; }
    </style>
</head>
<body>
    <div class="stars"></div>

    <div id="game-stage">
        <div id="menu-screen">
            <h1>[ENGLISH] ÂçïËØçÈ≠îÊ≥ïÁâπËÆ≠</h1>
            <div class="subtitle">Ê≤™ÊïôÁâàÂõõ‰∏ã ¬∑ Êô∫ËÉΩÁ≤æÁÆÄÁâà</div>
            <div id="unit-list"></div>
        </div>

        <div id="hud" style="display:none;">
            <div onclick="location.reload()" style="cursor:pointer"> Back (ÈÄÄÂá∫)</div>
            <div id="stage-info">Step 1</div>
            <div>Score: <span id="score">0</span></div>
        </div>

        <div id="center-display" style="display:none;">
            <div id="display-content"></div>
            <div id="status-text" style="height:25px; color:#aaa; font-size:14px; margin-bottom: 5px;"></div>
            <div id="options-container" style="display:flex; flex-direction:column; align-items:center; width:100%;"></div>
        </div>

        <div id="combat-layer">
            <div id="player">A</div>
            <div id="input-area">
                <input type="text" id="answer-input" placeholder="ËæìÂÖ•ÂçïËØç..." autocomplete="off">
            </div>
        </div>
    </div>

<script>
    // ËØçÂ∫ìÊï∞ÊçÆ
    const TEXTBOOK = {
        "Unit 1": [{en:"get up", cn:"Ëµ∑Â∫ä"}, {en:"have breakfast", cn:"ÂêÉÊó©È§ê"}, {en:"go to school", cn:"‰∏äÂ≠¶"}, {en:"have lunch", cn:"ÂêÉÂçàÈ§ê"}, {en:"go home", cn:"ÂõûÂÆ∂"}, {en:"have dinner", cn:"ÂêÉÊôöÈ§ê"}, {en:"go to bed", cn:"Áù°Ëßâ"}, {en:"daily", cn:"Êó•Â∏∏ÁöÑ"}, {en:"schedule", cn:"Êó•Á®ãÂÆâÊéí"}, {en:"at", cn:"Âú®(ÊüêÊó∂Èó¥)"}, {en:"o'clock", cn:"...ÁÇπÈíü"}, {en:"half", cn:"...ÁÇπÂçä"}, {en:"little", cn:"Âπ¥ÂπºÁöÑ"}, {en:"drink", cn:"Âñù; È•Æ"}, {en:"lesson", cn:"ËØæ"}, {en:"draw", cn:"Áîª"}, {en:"quarter", cn:"‰∏ÄÂàªÈíü"}, {en:"Miss", cn:"Â∞èÂßê"}, {en:"brush my teeth", cn:"Âà∑Áâô"}, {en:"wash my face", cn:"Ê¥óËÑ∏"}],
        "Unit 2": [{en:"Chinese", cn:"ËØ≠Êñá"}, {en:"Maths", cn:"Êï∞Â≠¶"}, {en:"English", cn:"Ëã±ËØ≠"}, {en:"PE", cn:"‰ΩìËÇ≤"}, {en:"Music", cn:"Èü≥‰πê"}, {en:"Art", cn:"ÁæéÊúØ"}, {en:"IT", cn:"‰ø°ÊÅØÊäÄÊúØ"}, {en:"Science", cn:"ÁßëÂ≠¶"}, {en:"club", cn:"Á§æÂõ¢"}, {en:"student", cn:"Â≠¶Áîü"}, {en:"different", cn:"‰∏çÂêåÁöÑ"}, {en:"subject", cn:"ÁßëÁõÆ"}, {en:"class", cn:"Áè≠Á∫ß;ËØæ"}, {en:"pig", cn:"Áå™"}, {en:"timetable", cn:"Êó∂Èó¥Ë°®"}, {en:"work out", cn:"ÁÆóÂá∫"}, {en:"model plane", cn:"È£ûÊú∫Ê®°Âûã"}],
        "Unit 3": [{en:"firefighter", cn:"Ê∂àÈò≤Âëò"}, {en:"police officer", cn:"Ë≠¶ÂØü"}, {en:"farmer", cn:"ÂÜúÂ§´"}, {en:"teacher", cn:"ËÄÅÂ∏à"}, {en:"doctor", cn:"ÂåªÁîü"}, {en:"bus driver", cn:"Âè∏Êú∫"}, {en:"fire", cn:"ÁÅ´"}, {en:"sick", cn:"ÁîüÁóÖÁöÑ"}, {en:"soup", cn:"Ê±§"}, {en:"Mrs", cn:"Â§´‰∫∫"}, {en:"job", cn:"Â∑•‰Ωú"}, {en:"people", cn:"‰∫∫‰ª¨"}, {en:"know", cn:"Áü•ÈÅì"}, {en:"dentist", cn:"ÁâôÂåª"}, {en:"hospital", cn:"ÂåªÈô¢"}, {en:"nurse", cn:"Êä§Â£´"}, {en:"check", cn:"Ê£ÄÊü•"}],
        "Unit 4": [{en:"triangle", cn:"‰∏âËßíÈìÅ"}, {en:"violin", cn:"Â∞èÊèêÁê¥"}, {en:"piano", cn:"Èí¢Áê¥"}, {en:"guitar", cn:"Âêâ‰ªñ"}, {en:"erhu", cn:"‰∫åËÉ°"}, {en:"flute", cn:"ÈïøÁ¨õ"}, {en:"drum", cn:"Èºì"}, {en:"woman", cn:"Â¶áÂ•≥"}, {en:"concert", cn:"Èü≥‰πê‰ºö"}, {en:"think", cn:"ÊÄùËÄÉ"}, {en:"clever", cn:"ËÅ™ÊòéÁöÑ"}, {en:"idea", cn:"ÊÉ≥Ê≥ï"}, {en:"beautiful", cn:"ÁæéÂ¶ôÁöÑ"}],
        "Unit 5": [{en:"paper-cut", cn:"Ââ™Á∫∏"}, {en:"painting", cn:"ÁªòÁîª"}, {en:"circle", cn:"ÂúÜÂΩ¢"}, {en:"square", cn:"Ê≠£ÊñπÂΩ¢"}, {en:"star", cn:"ÊòüÊòü"}, {en:"rectangle", cn:"ÈïøÊñπÂΩ¢"}, {en:"clock", cn:"Èíü"}, {en:"shape", cn:"ÂΩ¢Áä∂"}, {en:"side", cn:"Ëæπ"}, {en:"ask", cn:"ÈóÆ"}, {en:"tiger", cn:"ËÄÅËôé"}, {en:"say", cn:"ËØ¥"}],
        "Unit 6": [{en:"day", cn:"ÁôΩÂ§©"}, {en:"night", cn:"Â§úÊôö"}, {en:"hour", cn:"Â∞èÊó∂"}, {en:"minute", cn:"ÂàÜÈíü"}, {en:"second", cn:"Áßí"}, {en:"month", cn:"Êúà‰ªΩ"}, {en:"year", cn:"Âπ¥"}, {en:"measure", cn:"ÊµãÈáè"}, {en:"question", cn:"ÈóÆÈ¢ò"}, {en:"exercise", cn:"ËøêÂä®"}],
        "Unit 7": [{en:"liquid", cn:"Ê∂≤‰Ωì"}, {en:"solid", cn:"Âõ∫‰Ωì"}, {en:"gas", cn:"Ê∞î‰Ωì"}, {en:"sugar", cn:"Á≥ñ"}, {en:"salt", cn:"Áõê"}, {en:"melt", cn:"ËûçÂåñ"}, {en:"steam", cn:"Ê∞¥Ëí∏Ê∞î"}, {en:"heat", cn:"Âä†ÁÉ≠"}, {en:"hungry", cn:"È•øÁöÑ"}, {en:"ice cream", cn:"ÂÜ∞Ê∑áÊ∑ã"}, {en:"freezer", cn:"ÂÜ∞Êüú"}, {en:"mix", cn:"Ê∑∑Âêà"}],
        "Unit 8": [{en:"polite", cn:"ÊúâÁ§ºË≤åÁöÑ"}, {en:"take turns", cn:"ËΩÆÊµÅ"}, {en:"knock", cn:"Êï≤"}, {en:"ox", cn:"ÂÖ¨Áâõ"}, {en:"until", cn:"Áõ¥Âà∞..."}, {en:"invite", cn:"ÈÇÄËØ∑"}, {en:"behind", cn:"Âú®...ÂêéÈù¢"}, {en:"cry", cn:"Âì≠"}, {en:"kind", cn:"ÂèãÂñÑÁöÑ"}, {en:"helpful", cn:"‰πê‰∫éÂä©‰∫∫ÁöÑ"}]
    };
    
    let queue=[],qIndex=0,step=1,score=0,recognition=null,isMobile=false;
    const synth=window.speechSynthesis;

    function checkEnv(){
        const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
        if(SR){try{recognition=new SR();recognition.lang='en-US';recognition.continuous=false;}catch(e){recognition=null;}}
        if(!recognition||/Android|iPhone|iPad|iPod/i.test(navigator.userAgent)){isMobile=true;}
    }

    // Á°Æ‰øùÈ°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÊâßË°å
    window.onload = function() {
        checkEnv();
        const list=document.getElementById('unit-list');
        for(let u in TEXTBOOK){
            let btn=document.createElement('div');
            btn.className='unit-btn';
            btn.innerText=u;
            btn.onclick=()=>startGame(u);
            list.appendChild(btn);
        }
    };

    function startGame(u){
        document.getElementById('menu-screen').style.display='none';
        document.getElementById('hud').style.display='flex';
        document.getElementById('center-display').style.display='flex';
        queue=TEXTBOOK[u];qIndex=0;step=1;score=0;loadLevel();
    }

    function loadLevel(){
        if(qIndex>=queue.length){
            if(step<4){step++;qIndex=0;alert("Level Up! ËøõÂÖ•Á¨¨ "+step+" ÂÖ≥!");loadLevel();}
            else{alert("Congratulations! Êú¨ÂçïÂÖÉÈÄöÂÖ≥!");location.reload();}
            return;
        }
        const t=["","Step 1: Memory (ËÆ∞ÂøÜ)","Step 2: Listen (Âê¨Âäõ)","Step 3: Meaning (‰∫íËØë)","Step 4: Spell (ÊãºÂÜô)"];
        document.getElementById('stage-info').innerText=t[step];
        document.getElementById('score').innerText=score;
        document.getElementById('display-content').innerHTML='';
        document.getElementById('options-container').innerHTML='';
        document.getElementById('status-text').innerText='';
        document.getElementById('center-display').style.display='flex';
        document.getElementById('combat-layer').style.display='none';
        
        const w=queue[qIndex];
        if(step===1)runStep1(w);else if(step===2)runStep2(w);else if(step===3)runStep3(w);else if(step===4)runStep4(w);
    }

    function speak(t){if(synth.speaking)synth.cancel();let u=new SpeechSynthesisUtterance(t);u.lang='en-US';synth.speak(u);}

    function runStep1(w){
        document.getElementById('display-content').innerHTML='<div class="big-word">'+w.en+'</div><div class="hint-text">'+w.cn+'</div>';
        setTimeout(()=>speak(w.en),300);
        let c=document.getElementById('options-container');
        if(isMobile){
            document.getElementById('status-text').innerText="Please Listen (ËØ∑ËÆ∞ÂøÜ)";
            let b=document.createElement('div');b.className='option-btn';b.innerText="Next (ËÆ∞‰Ωè‰∫Ü)";
            b.style.background="#2980b9";
            b.onclick=()=>{score+=5;next();};c.appendChild(b);
        }else{
            document.getElementById('status-text').innerText="Read Aloud (ËØ∑Ë∑üËØª)";
            let b=document.createElement('div');b.className='option-btn';b.innerText="Click to Read (ÁÇπÂáªË∑üËØª)";
            let s=document.getElementById('status-text');
            b.onclick=()=>{
                b.style.background="#f39c12";b.innerText="Listening...";
                try{recognition.start();}catch(e){}
                recognition.onresult=(e)=>{
                    let t=e.results[0][0].transcript.toLowerCase();
                    if(t.includes(w.en.toLowerCase())||t.length>0){s.innerText="Excellent!";score+=10;setTimeout(next,800);}
                };
            };
            c.appendChild(b);
            let k=document.createElement('div');k.innerText="Pass (Ë∑≥Ëøá)";k.style.color="#888";k.style.marginTop="10px";k.style.cursor="pointer";k.onclick=next;c.appendChild(k);
        }
    }

    function runStep2(w){
        document.getElementById('display-content').innerHTML='<div style="font-size:60px; margin:20px 0; cursor:pointer" onclick="speak(\''+w.en+'\')">üîä</div>';
        document.getElementById('status-text').innerText="Listen and Choose (Âê¨Èü≥ÈÄâ‰πâ)";
        speak(w.en);
        getOpts(w,'cn').forEach(o=>{
            let b=document.createElement('div');b.className='option-btn';b.innerText=o.cn;
            b.onclick=()=>{if(o===w){b.classList.add('correct');score+=10;setTimeout(next,500);}else{b.classList.add('wrong');speak("No");}};
            document.getElementById('options-container').appendChild(b);
        });
    }

    function runStep3(w){
        document.getElementById('display-content').innerHTML='<div class="big-word">'+w.cn+'</div>';
        getOpts(w,'en').forEach(o=>{
            let b=document.createElement('div');b.className='option-btn';b.innerText=o.en;
            b.onclick=()=>{if(o===w){b.classList.add('correct');speak(w.en);score+=10;setTimeout(next,500);}else{b.classList.add('wrong');}};
            document.getElementById('options-container').appendChild(b);
        });
    }

    function runStep4(w){
        document.getElementById('center-display').style.display='none';
        document.getElementById('combat-layer').style.display='block';
        let i=document.getElementById('answer-input');i.value='';i.focus();
        let e=document.createElement('div');e.className='enemy';e.innerText=w.cn;
        e.style.top='100px';e.style.left=(Math.random()*(window.innerWidth-150)+20)+"px";
        document.getElementById('combat-layer').appendChild(e);
        const chk=()=>{
            if(i.value.trim().toLowerCase()===w.en.toLowerCase()){
                let b=document.createElement('div');b.className='bullet';
                let p=document.getElementById('player');
                b.style.bottom='130px';b.style.left='50%';
                document.getElementById('combat-layer').appendChild(b);
                setTimeout(()=>{
                    b.style.transition="top 0.2s";b.style.top=e.style.top;b.style.left=e.style.left;
                    setTimeout(()=>{e.remove();b.remove();speak(w.en);score+=20;next();},200);
                },10);
            }
        };
        i.onkeypress=(evt)=>{if(evt.key==='Enter')chk();};
        i.oninput=()=>{if(i.value.trim().toLowerCase()===w.en.toLowerCase())chk();};
    }

    function next(){qIndex++;loadLevel();}
    function getOpts(c,k){let a=[c];while(a.length<3){let r=queue[Math.floor(Math.random()*queue.length)];if(!a.includes(r))a.push(r);}return a.sort(()=>Math.random()-0.5);}
</script>
</body>
</html>
